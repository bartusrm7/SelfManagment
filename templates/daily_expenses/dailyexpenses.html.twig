{% extends 'base.html.twig' %}
{% block title %}Self-Management - Daily Expenses
{% endblock %}
{% block breadcrumbActive %}Daily Expenses
{% endblock %}
{% block body %}
	<div class="card">
		<div class="card-body">
			<div class="d-sm-flex justify-content-between align-items-center mb-3">
				<h5>Set budget for a date:
					<span class="opacity-50">
						<select class="rounded-3" id="monthSelect">
							{% for i in 1..12 %}
								{% set m = '%02d'|format(i) %}
								<option value="{{ m }}" {{ selectedMonth == m ? 'selected' }}>
									{{ (selectedYear ~ '-' ~ m)|date('F') }}
								</option>
							{% endfor %}
						</select>
						<select class="rounded-3" id="yearSelect">
							{% for y in 2020..2030 %}
								<option value="{{ y }}" {{ selectedYear == y ? 'selected' }}>
									{{ y }}
								</option>
							{% endfor %}
						</select>
					</span>
				</h5>
				<div>
					<a href="{{ path('app_daily_expenses_budget', { year: selectedYear, month: selectedMonth }) }}" class="btn btn-dark border-light fw-bold px-4">Set budget</a>
				</div>
			</div>

			<div class="d-flex flex-wrap justify-content-evenly justify-content-md-start">
				<div class="card text-white text-bg-success mb-3">
					<h5 class="card-header text-center">Budget sum</h5>
					<div class="card-body">
						<h4 class="card-text fw-bold">{{ budget }}$</h4>
					</div>
				</div>
				<div class="card text-white text-bg-warning mb-3">
					<h5 class="card-header text-center">Current budget</h5>
					<div class="card-body">
						<h4 class="card-text fw-bold">{{ restAmount }}$</h4>
					</div>
				</div>
				<div class="card text-white text-bg-danger mb-3">
					<h5 class="card-header text-center">Expenses amount</h5>
					<div class="card-body">
						<h4 class="card-text fw-bold">
							{% if budgetRest > 0 %}-{{ budgetRest }}$
							{% else %}
								{{ budgetRest }}$
							{% endif %}
						</h4>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="card mt-3">
		<div class="card-body">
			<div class="d-sm-flex justify-content-between align-items-center mb-3">
				<h5>Add new expense for current budget</h5>
				<div>
					<a href="{{ path('app_daily_expenses_add_expense', { year: selectedYear, month: selectedMonth }) }}" class="btn btn-dark border-light fw-bold px-4">Add expense</a>
				</div>
			</div>
			<table class="table table-hover table-bordered">
				<thead>
					<tr>
						<th class="col-2">#</th>
						<th class="col-4">Name</th>
						<th class="col-2">Amount</th>
						<th class="col-2">Date</th>
					</tr>
				</thead>
				<tbody>
					{% for expense in expenses %}
						{% if expense.amount is not empty %}
							<tr>
								<th>{{loop.index}}</th>
								<td>{{expense.name ?? ''}}</td>
								<td>{{expense.amount ?? ''}}</td>
								<td>{{expense.date|date('Y-m-d')}}</td>
							</tr>
						{% endif %}
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
<script>
	const year = document.getElementById('yearSelect'); 
	const month = document.getElementById('monthSelect'); 
	function hrefFunction() { 
		location.href = `/daily-expenses/${year.value}/${month.value}`; 
	}
	year.addEventListener('change', hrefFunction); 
	month.addEventListener('change', hrefFunction);
</script>
{% endblock %}
