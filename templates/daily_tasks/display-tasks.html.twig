{% extends 'base.html.twig' %} {% block title %}Self-Management - Tasks {%
endblock %} {% block breadcrumbActive %}Daily tasks {% endblock %} {% block body
%}
<div class="card">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
            {{ form_start(filter) }}
            {{ form_row(filter.taskDate) }}
            {{ form_end(filter) }}
            <a
                href="{{ path('app_create_daily_tasks', {'date': filter.taskDate.vars.value}) }}"
                class="btn btn-dark border-light float-end fw-bold"
                >Create new daily task</a
            >
        </div>

        <table class="table table-hover table-bordered">
            <thead>
                <tr>
                    <th class="col-1 text-center">#</th>
                    <th class="col-3 text-center">Name</th>
                    <th class="col-5 text-center">Description</th>
                    <th class="col-1 text-center">Progress</th>
                    <th class="col-2 text-center">Actions</th>
                </tr>
            </thead>
            <tbody class="table-group-divider">
                {% for task in tasks %}
                <tr class="align-middle">
                    <th class="text-center">{{ loop.index }}</th>
                    <td>{{ task.taskName }}</td>
                    <td>{{ task.taskDescription }}</td>
                    <td class="text-center task-done-td">
                        {% if task.taskDone == true %}
                        <i class="bi bi-check-square-fill task-done-icon"></i>
                        {% endif %}
                    </td>
                    <td>
                        <div class="d-flex justify-content-center">
                            <button
                                class="btn btn-light task-done-btn me-1"
                                data-task-id="{{ task.id }}"
                            >
                                <i class="bi bi-check2-square"></i>
                            </button>
                            <a
                                href="{{
                                    path('app_edit_daily_task', { id: task.id })
                                }}"
                                class="btn btn-light task-edit-btn me-1"
                            >
                                <i class="bi bi-pencil"></i>
                            </a>
                            <button
                                class="btn btn-light task-remove-btn"
                                data-task-id="{{ task.id }}"
                            >
                                <i class="bi bi-trash3"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    const handleDoneTask = () => {
        document.querySelectorAll(".task-done-btn").forEach((taskBtn) => {
            const id = taskBtn.dataset.taskId;

            taskBtn.addEventListener("click", async () => {
                const response = await fetch(`/daily-tasks/done-task/${id}`, {
                    method: "POST",
                    headers: {
                        "X-Requested-With": "XMLHttpRequest",
                    },
                });
                const data = await response.json();
                const td = taskBtn.closest("tr").querySelector(".task-done-td");
                if (data.success) {
                    if (data.done) {
                        td.innerHTML =
                            '<i class="bi bi-check-square-fill task-done-icon"></i>';
                    } else {
                        td.innerHTML = "";
                    }
                }
            });
        });
    };
    handleDoneTask();

    const handleRemoveTask = () => {
        document.querySelectorAll(".task-remove-btn").forEach((taskBtn) => {
            const id = taskBtn.dataset.taskId;

            taskBtn.addEventListener("click", async () => {
                const response = await fetch(`/daily-tasks/remove-task/${id}`, {
                    method: "DELETE",
                    headers: {
                        "X-Requested-With": "XMLHttpRequest",
                    },
                });
                if (response.ok) {
                    taskBtn.closest("tr").remove();
                }
            });
        });
    };
    handleRemoveTask();
</script>

{% endblock %}
